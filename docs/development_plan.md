# 「酔いの地図帳」開発計画書

> 凡例：
>
> - 🤔 要検討：具体的な方針の決定が必要
> - ⚡ 技術調査：実現可能性の確認が必要
> - 📝 詳細化：より具体的な内容の詳細化が必要
> - 💭 オプション：時間に余裕があれば実装を検討

## 📋 プロジェクト概要

### 💡 開発目的と背景

- カクテルバーやウイスキーバーの情報を地図上で簡単に探せるアプリケーション
- バーの特徴や雰囲気を直感的に把握可能
- 効率的なバー探しをサポート
- 個人の訪問記録機能の提供

### 💬 企画背景

既存のバー検索サービスを調査した結果、以下の課題を発見：

- **既存サービスの限界**:
  - 網羅性が高いサントリーの BAR-NAVI（https://bar-navi.suntory.co.jp/）は狙った検索ができなかったり動作が重かったり（特にスマホ）と不満が多い
  - その他の方法では食べログ等グルメサイトに頼ることになるが、いわゆる”バー”の掲載数が少なかったり絞り込みにくい（バーらしくない居酒屋等も入ってしまう）
- **情報収集の分散化**: 結局一番見つけやすいのは Google Maps だが、実際に行った人の口コミやお店の詳細情報は Instagram 等の SNS に頼ることになりがち
- **情報の質**: バーの特徴（得意なお酒、雰囲気）が一目で分かりにくい
- **記録機能の不足**: 個人の訪問記録や感想を残す場所がない

### 📊 データ戦略

#### 現状（MVP 段階）

- **技術検証用サンプルデータ**: 60 件の仮データで機能実装を優先
- **基本情報**: 公開情報をベースにした検索動作確認用

#### 将来計画（リアルデータ移行）

- **実地調査データ**: 東京都内 40 店舗以上の訪問実績を活用
- **一次情報の収集**:
  - マスターとの対話で得た「真の得意分野」
  - 実際の座席レイアウト・席数
  - 時間帯別の雰囲気の変化
  - リアルな価格帯・おすすめメニュー
- **オリジナル写真**: 店内・外観・メニューの実撮影
- **継続的な更新**: 新規開拓した店舗の随時追加

#### データ品質へのこだわり

既存のバー検索サービスは「公開情報の寄せ集め」が多い中、**「実際に行った人にしか分からない情報」**を提供することで差別化を図る計画。

### 🎯 主要機能の詳細

#### 1. 店舗情報管理機能

- **基本情報表示**
  - 店舗名、住所、営業時間
  - 予算帯、チャージ料金
  - 座席タイプ、喫煙状況
  - 各種メニュー情報
- **専門分野表示**
  - メインのお酒の種類
  - 対応可能なドリンク
  - 詳細な特徴説明
- **Google Maps 連携**
  ⚡ Google Places API の利用範囲と制限の確認が必要
  - 地図上での位置表示
  - 情報ウィンドウ表示
  - 店舗周辺情報の表示

#### 2. 検索・フィルター機能

- **基本検索**
  - キーワード検索（店舗名、地域）
  - 地図範囲での検索
  - 現在地からの検索
- **詳細フィルター**
  🤔 フィルター条件の優先順位付けが必要
  - お酒の種類による絞り込み
  - 予算帯でのフィルタリング
  - 席タイプ、喫煙状況での絞り込み
  - 営業時間での絞り込み
- **検索結果表示**
  📝 検索結果の表示形式の詳細設計が必要
  - リスト表示とマップ表示の切り替え
  - 検索結果のソート機能
  - フィルター条件の保持

#### 3. お気に入り・訪問記録機能

- **お気に入り管理**
  - お気に入り店舗の登録/解除
  - お気に入りリストの表示
  - マップでのお気に入り表示
- **訪問記録**
  🤔 訪問記録の項目と形式の検討が必要
  - 訪問日時の記録
  - メモ機能（感想、注文したドリンクなど）
  - 訪問履歴の管理

## 🗃️ データベース設計

### テーブル構造

#### bars テーブル

```ruby
create_table "bars", force: :cascade do |t|
  # 基本情報（必須）
  t.string   "name",           null: false
  t.string   "address",        null: false
  t.string   "price_range",    null: false
  t.string   "smoking_status", null: false

  # 基本情報（オプション）
  t.string   "phone"
  t.string   "business_hours"
  t.float    "latitude"
  t.float    "longitude"
  t.integer  "cover_charge"

  # 設備・サービス情報
  t.string   "seat_types",     array: true
  t.string   "food_menu_type"
  t.string   "soft_drinks_menu"
  t.string   "non_alcoholic_drinks"

  # 説明・その他
  t.text     "atmosphere"
  t.text     "description"
  ⚡ t.string   "google_place_id"            # Google Places API連携の確認が必要
end
```

📝 インデックス設計の詳細化が必要

```ruby
# 追加予定のインデックス
t.index ["latitude", "longitude"]
t.index ["name"]
t.index ["price_range"]
```

#### specialties テーブル

```ruby
create_table "specialties", force: :cascade do |t|
  t.references "bar",        null: false, index: true
  t.string     "category",   null: false
  t.boolean    "is_main",    null: false
  t.text       "description"
end
```

🤔 カテゴリーの追加・変更の可能性について検討が必要

#### favorites テーブル

```ruby
create_table "favorites", force: :cascade do |t|
  t.references "bar",        null: false, index: true
  t.references "user",       null: false, index: true
  t.text       "memo"
  t.date       "visited_at"
  t.timestamps
end
```

## 📅 開発フェーズ

### Phase 1: 基盤構築

#### Week 1: 環境構築とデータ準備

1. **開発環境セットアップ**
   ⚡ Docker の導入是非の検討

   - Ruby/Rails/PostgreSQL 環境構築
   - GitHub リポジトリ設定
   - Google Maps API 設定

2. **データベース設計と実装**

   - マイグレーションファイル作成
   - モデル実装とバリデーション
     📝 バリデーションルールの詳細化が必要

3. **初期データ準備**
   - CSV インポート機能実装
   - テストデータ作成（5-10 店舗）
     🤔 初期データの収集方法の検討が必要

#### Week 2-3: 基本機能実装

1. **店舗情報表示機能**
   📝 画面レイアウトの詳細設計が必要

   - 一覧表示ページ
   - 詳細表示ページ
   - 基本レイアウト設定

2. **Google Maps 連携**
   ⚡ API の利用制限と費用の確認が必要
   - 地図表示コンポーネント
   - マーカー表示機能
   - 情報ウィンドウ実装

### Phase 2: 検索機能実装

#### Week 1-2: 基本検索機能

🤔 検索機能の優先順位付けが必要

1. **検索フォームの実装**

   - キーワード検索
   - 条件検索フォーム
   - 検索結果表示

2. **地図連携検索**
   - 地図範囲での検索
   - 現在地からの検索
   - 検索結果のマーカー表示

#### Week 3: 検索機能の拡張

💭 時間に余裕があれば実装を検討

1. **詳細検索オプション**
   - 複合条件検索
   - フィルター機能強化
   - ソート機能

### Phase 3: UI/UX 改善とお気に入り機能

#### Week 1: ユーザー認証とお気に入り機能

1. **認証機能実装**
   🤔 認証方式の検討が必要（devise vs 独自実装）

   - ユーザー登録/ログイン
   - 認証要件の実装

2. **お気に入り機能実装**
   - お気に入り登録/解除
   - 訪問記録機能
   - メモ機能

#### Week 2: UI/UX 改善

📝 具体的な UI/UX デザインの詳細化が必要

1. **レスポンシブ対応**

   - モバイル対応
   - タブレット対応
   - 画面遷移の最適化

2. **パフォーマンス改善**
   - N+1 問題対策
   - クエリ最適化
   - キャッシュ実装

## 🎨 UI/UX 設計

📝 全体的なデザインテーマの設定が必要

### 画面構成

1. **トップページ**
   🤔 レイアウトの比率検討が必要

   - 地図エリア（画面の 60-70%？）
   - 検索フォーム（画面上部）
   - 検索結果リスト（サイドバー）

2. **店舗詳細ページ**
   - 基本情報セクション
   - 地図セクション
   - 専門分野セクション
   - 訪問記録セクション（ログイン時）

### レスポンシブデザイン方針

📝 ブレイクポイントの詳細設定が必要

- スマートフォン: ~767px
- タブレット: 768px~1023px
- デスクトップ: 1024px~

## 🛠 使用技術

⚡ バージョンの互換性確認が必要

- Ruby 3.3.3
- Rails 7.1.5.1（実際の実装では 7.1.5.1 を使用）
- PostgreSQL
- Google Maps API
- Tailwind CSS

## ⚠️ 開発時の注意点

1. **データ収集**
   🤔 データ収集・更新方針の検討が必要

   - 最初は 20 店舗程度に絞る
   - 実際に訪問したバーを中心に
   - 基本情報は公開情報から収集

2. **API 利用**
   ⚡ API 利用制限と費用の確認が必要

   - Google Maps API
   - Google Places API
   - API キーの管理方法

3. **パフォーマンス**
   📝 具体的な目標値の設定が必要
   - 読み込み速度
   - レスポンス時間
   - データ容量

## 💫 将来の拡張候補

💭 優先順位付けが必要

- カクテルデータベース連携
- 詳細なレビュー機能
- SNS 連携
- コミュニティ機能
- 写真管理機能
- カレンダー連携

## 📝 コーディング規約

### 1. Ruby/Rails コーディング規約

📝 具体的なコーディング規約の詳細化が必要

- Rubocop によるコード整形
- メソッド名は動詞で始める
- クラス名は名詞で始める
- 適切なインデントとスペース

### 2. JavaScript/CSS コーディング規約

🤔 TailwindCSS の利用範囲の検討が必要

- ESLint によるコード整形
- コンポーネント単位での実装
- CSS 命名規則（BEM）の採用
- TailwindCSS ユーティリティの活用

## 🔒 セキュリティ対策

### 1. 認証・認可

🤔 認証方式の詳細検討が必要

- devise によるユーザー認証
- 管理者権限の実装
- セッション管理の設定

### 2. API セキュリティ

⚡ API 制限の確認と対策の検討が必要

- API キーの環境変数管理
- CORS 設定
- レートリミット設定

### 3. データ保護

📝 セキュリティ要件の詳細化が必要

- パスワードのハッシュ化
- センシティブデータの暗号化
- XSS 対策
- CSRF 対策

## 📊 モニタリングと分析

### 1. エラー監視

⚡ 監視ツールの選定が必要

- Rails ログの監視
- 例外の捕捉と通知
- パフォーマンスメトリクスの収集

### 2. アクセス分析

💭 分析項目の検討が必要

- Google Analytics の導入
- ユーザー行動の分析
- パフォーマンスデータの収集

### 3. パフォーマンスモニタリング

📝 具体的な監視項目と閾値の設定が必要

- レスポンスタイムの計測
- DB クエリの監視
- メモリ使用量の監視

## 🚀 デプロイメント戦略

### 1. 環境構成

🤔 本番環境の選定が必要

- 開発環境（ローカル）
- テスト環境（Heroku Review Apps）
- ステージング環境
- 本番環境（実際には Render を選定）

### 2. デプロイメントプロセス

📝 CI/CD パイプラインの詳細設計が必要

- GitHubActions による自動デプロイ
- マイグレーションの自動実行
- アセットのプリコンパイル
- 環境変数の管理

### 3. バックアップ戦略

⚡ バックアップツールの選定が必要

- データベースの定期バックアップ
- 環境設定のバージョン管理
- リストア手順の整備

## 🧪 テスト計画

### 1. 自動テスト

📝 テストケースの詳細化が必要

- モデルスペック
  - バリデーションテスト
  - スコープのテスト
  - メソッドのテスト
- システムスペック
  - 検索機能テスト
  - お気に入り機能テスト
  - 地図表示テスト

### 2. 手動テスト

🤔 テスト環境とブラウザの選定が必要

- クロスブラウザテスト
  - Chrome/Firefox/Safari
  - モバイルブラウザ
- ユーザビリティテスト
  - 画面遷移テスト
  - レスポンシブ動作確認
  - パフォーマンステスト

## ⚠️ リスク管理

### 1. データ関連リスク

📝 リスク対策の具体化が必要

- データ整合性の崩れ
- バックアップの失敗
- インポートエラー

### 2. システム関連リスク

⚡ 具体的な対策方法の検討が必要

- API 制限の超過
- パフォーマンスの劣化
- セキュリティ脆弱性

### 3. 運用関連リスク

🤔 運用体制の検討が必要

- データ更新の遅延
- ユーザーサポート体制
- 障害対応体制

---

## 🎯 実装における重要な設計判断（追記）

### CRUD 機能の見送り判断

**当初計画**: Phase 3 でユーザー認証・お気に入り機能実装予定

**実際の判断**: 検索特化型プラットフォームとして MVP 完成を優先

- コア価値（バー検索体験）の最大化
- 限られた時間でのクオリティ向上
- SUUMO のようなキュレーション型プラットフォーム戦略

この判断により、予定していた Phase 3 の一部機能は将来フェーズに移行。

---

## 優先検討事項一覧

### 🤔 方針決定が必要な項目

1. データ収集・更新方法の確定
2. 認証方式の選定（devise vs 独自実装）
3. フィルター条件の優先順位付け
4. 本番環境の選定と構成
5. 運用体制の検討

### ⚡ 技術調査が必要な項目

1. Google Maps API/Places API の利用制限と費用
2. Docker 導入の是非
3. 監視ツールの選定
4. バックアップツールの選定
5. API 制限対策の検討

### 📝 詳細化が必要な項目

1. UI/UX デザインの詳細設計
2. バリデーションルールの詳細化
3. コーディング規約の具体化
4. CI/CD パイプラインの詳細設計
5. テストケースの詳細化

### 💭 オプション機能（優先順位付けが必要）

1. 複合条件検索機能
2. カクテルデータベース連携
3. SNS 連携機能
4. コミュニティ機能
5. 写真管理機能
