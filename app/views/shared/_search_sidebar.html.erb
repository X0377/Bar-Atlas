<%= search_form_for @q, url: bars_path, method: :get, local: true, html: { id: 'unified-search-form' } do |f| %>
  <!-- キーワード検索 -->
  <!-- 入力後フォーム入力から強制的に離されてしまう問題あり -->
  <div class="mb-8">
    <%= f.text_field :name_or_address_or_phone_or_smoking_status_or_description_or_specialties_category_cont,
        placeholder: "キーワードでバーを検索...",
        class: "search-input",
        value: params.dig(:q, :name_or_address_or_phone_or_smoking_status_or_description_or_specialties_category_cont) %>
  </div>
  <!-- エリア検索 -->
  <div class="mb-6">
    <div class="sidebar-section-title">エリア</div>
    <div class="mb-3">
      <%= f.text_field :address_cont,
          placeholder: "エリアを入力...",
          class: "search-input",
          value: params.dig(:q, :address_cont) %>
    </div>
    <div class="filter-options-container">
      <% %w[新宿 六本木 恵比寿 渋谷].each do |area| %>
        <div class="filter-option <%= 'active' if params.dig(:q, :address_cont) == area %>"
             onclick="setFilterValue('address_cont', '<%= area %>')">
          <span class="filter-option-label"><%= area %></span>
          <span class="filter-option-count"><%= Bar.where('address ILIKE ?', "%#{area}%").count %></span>
        </div>
      <% end %>
      <% if params.dig(:q, :address_cont).present? %>
        <div class="filter-option" onclick="clearFilterValue('address_cont')">
          <span class="text-lg">🔄</span>
          <span class="filter-option-label">すべて表示</span>
        </div>
      <% end %>
    </div>
  </div>
  <!-- 価格帯フィルター -->
  <div class="mb-6">
    <div class="sidebar-section-title">価格帯</div>
    <div class="filter-options-container">
      <% [
        { value: 'リーズナブル', emoji: '💰', label: 'リーズナブル' },
        { value: '標準', emoji: '💵', label: '標準' },
        { value: '高級', emoji: '💎', label: '高級' }
      ].each do |option| %>
        <div class="filter-option <%= 'active' if params.dig(:q, :price_range_eq) == option[:value] %>"
             onclick="setFilterValue('price_range_eq', '<%= option[:value] %>')">
          <span class="text-lg"><%= option[:emoji] %></span>
          <span class="filter-option-label"><%= option[:label] %></span>
          <span class="filter-option-count"><%= Bar.where(price_range: option[:value]).count %></span>
        </div>
      <% end %>
      <% if params.dig(:q, :price_range_eq).present? %>
        <div class="filter-option" onclick="clearFilterValue('price_range_eq')">
          <span class="text-lg">🔄</span>
          <span class="filter-option-label">すべて表示</span>
        </div>
      <% end %>
    </div>
    <%= f.hidden_field :price_range_eq, value: params.dig(:q, :price_range_eq) %>
  </div>
  <!-- 喫煙状況フィルター -->
  <div class="mb-6">
    <div class="sidebar-section-title">喫煙状況</div>
    <div class="filter-options-container">
      <% [
        { value: '禁煙', emoji: '🚭', label: '禁煙' },
        { value: '分煙', emoji: '🚫', label: '分煙' },
        { value: '喫煙可', emoji: '🚬', label: '喫煙可' }
      ].each do |option| %>
        <div class="filter-option <%= 'active' if params.dig(:q, :smoking_status_eq) == option[:value] %>"
             onclick="setFilterValue('smoking_status_eq', '<%= option[:value] %>')">
          <span class="text-lg"><%= option[:emoji] %></span>
          <span class="filter-option-label"><%= option[:label] %></span>
          <span class="filter-option-count"><%= Bar.where(smoking_status: option[:value]).count %></span>
        </div>
      <% end %>
      <% if params.dig(:q, :smoking_status_eq).present? %>
        <div class="filter-option" onclick="clearFilterValue('smoking_status_eq')">
          <span class="text-lg">🔄</span>
          <span class="filter-option-label">すべて表示</span>
        </div>
      <% end %>
    </div>
    <%= f.hidden_field :smoking_status_eq, value: params.dig(:q, :smoking_status_eq) %>
  </div>
  <!-- 全条件クリア -->
  <% if search_performed? %>
    <div class="mb-6">
      <div class="filter-option" onclick="clearAllFiltersUnified()" style="justify-content: center; background-color: var(--wine); color: white;">
        <span class="text-lg">🔄</span>
        <span class="filter-option-label">すべての条件をクリア</span>
      </div>
    </div>
  <% end %>
<% end %>
