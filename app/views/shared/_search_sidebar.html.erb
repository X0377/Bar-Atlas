<%= search_form_for @q, url: bars_path, method: :get, local: true, html: { id: 'unified-search-form' } do |f| %>
  <div class="mb-8">
    <%= f.text_field :name_or_address_or_phone_or_smoking_status_or_description_or_specialties_category_cont,
        placeholder: "„Ç≠„Éº„ÉØ„Éº„Éâ„Åß„Éê„Éº„ÇíÊ§úÁ¥¢...",
        class: "search-input",
        value: params.dig(:q, :name_or_address_or_phone_or_smoking_status_or_description_or_specialties_category_cont) %>
  </div>
  <!-- „É¨„Çπ„Éù„É≥„Ç∑„ÉñË°®Á§∫Êú™ÂÆüË£Ö„ÅÆ„Åü„ÇÅÊö´ÂÆöÁöÑ„Å´ÈùûË°®Á§∫ÂØæÂøú -->
  <div class="hidden lg:block">
    <!-- „Ç®„É™„Ç¢„Éï„Ç£„É´„Çø„Éº -->
    <div class="mb-6">
      <div class="sidebar-section-title">„Ç®„É™„Ç¢</div>
      <div class="mb-3">
        <%= f.text_field :address_cont,
          placeholder: "„Ç®„É™„Ç¢„ÇíÂÖ•Âäõ...",
          class: "search-input",
          value: params.dig(:q, :address_cont) %>
      </div>
      <div class="filter-options-container">
        <% %w[Êñ∞ÂÆø ÂÖ≠Êú¨Êú® ÊÅµÊØîÂØø Ê∏ãË∞∑ ÈäÄÂ∫ß].each do |area| %>
          <div class="filter-option <%= 'active' if params.dig(:q, :address_cont) == area %>"
             onclick="setFilterValue('address_cont', '<%= area %>')">
            <span class="filter-option-label"><%= area %></span>
          </div>
        <% end %>
        <% if params.dig(:q, :address_cont).present? %>
          <div class="filter-option" onclick="clearFilterValue('address_cont')">
            <span class="filter-option-label">„Åô„Åπ„Å¶Ë°®Á§∫</span>
          </div>
        <% end %>
      </div>
    </div>
    <!-- „Çπ„Éö„Ç∑„É£„É™„ÉÜ„Ç£„Éï„Ç£„É´„Çø„Éº -->
    <div class="mb-6">
      <div class="sidebar-section-title">ÂæóÊÑèÂàÜÈáé</div>
      <div class="filter-options-container">
        <% [
        { value: '„Ç¶„Ç§„Çπ„Ç≠„Éº', emoji: 'ü•É', label: '„Ç¶„Ç§„Çπ„Ç≠„Éº' },
        { value: '„Ç´„ÇØ„ÉÜ„É´', emoji: 'üç∏', label: '„Ç´„ÇØ„ÉÜ„É´' },
        { value: '„ÉØ„Ç§„É≥', emoji: 'üç∑', label: '„ÉØ„Ç§„É≥' },
        { value: '„Éì„Éº„É´', emoji: 'üç∫', label: '„Éì„Éº„É´' },
        { value: 'Êó•Êú¨ÈÖí', emoji: 'üç∂', label: 'Êó•Êú¨ÈÖí' },
        { value: 'ÁÑºÈÖé', emoji: 'ü•É', label: 'ÁÑºÈÖé' },
        { value: '„Ç∑„É£„É≥„Éë„É≥', emoji: 'ü•Ç', label: '„Ç∑„É£„É≥„Éë„É≥' }
      ].each do |specialty| %>
          <div class="filter-option specialty-filter-option <%= 'active' if params.dig(:q, :specialties_category_eq) == specialty[:value] %>"
             onclick="setFilterValue('specialties_category_eq', '<%= specialty[:value] %>')">
            <span class="text-lg"><%= specialty[:emoji] %></span>
            <span class="filter-option-label"><%= specialty[:label] %></span>
          </div>
        <% end %>
        <% if params.dig(:q, :specialties_category_eq).present? %>
          <div class="filter-option" onclick="clearFilterValue('specialties_category_eq')">
            <span class="filter-option-label">„Åô„Åπ„Å¶Ë°®Á§∫</span>
          </div>
        <% end %>
      </div>
      <%= f.hidden_field :specialties_category_eq, value: params.dig(:q, :specialties_category_eq) %>
    </div>
    <!-- ‰æ°Ê†ºÂ∏Ø„Éï„Ç£„É´„Çø„ÉºÔºà„Éõ„Éê„Éº„Éò„É´„Éó‰ªò„ÅçÔºâ -->
    <div class="mb-6">
      <div class="sidebar-section-title">‰æ°Ê†ºÂ∏Ø</div>
      <div class="filter-options-container">
        <% [
        {
          value: 'reasonable',
          label: '„É™„Éº„Ç∫„Éä„Éñ„É´',
          description: '‰∏ãÈôê„Äú¬•4,000 „Åæ„Åü„ÅØ ‰∏äÈôê„Äú¬•4,500',
          emoji: 'üí∞'
        },
        {
          value: 'standard',
          label: 'Ê®ôÊ∫ñ',
          description: '¬•4,000„Äú¬•8,000Á®ãÂ∫¶„ÅÆ‰æ°Ê†ºÂ∏Ø',
          emoji: 'üí≥'
        },
        {
          value: 'luxury',
          label: 'È´òÁ¥ö',
          description: '‰∏ãÈôê¬•8,000„Äú „Åæ„Åü„ÅØ ‰∏äÈôê¬•10,000„Äú',
          emoji: 'üíé'
        }
      ].each do |option| %>
          <div class="filter-option price-filter-option <%= 'active' if params.dig(:q, :price_category_eq) == option[:value] %>"
             onclick="setFilterValue('price_category_eq', '<%= option[:value] %>')"
             data-tooltip="<%= option[:description] %>">
            <span class="text-lg"><%= option[:emoji] %></span>
            <div class="flex-1">
              <span class="filter-option-label"><%= option[:label] %></span>
              <div class="text-xs text-gray-500 hidden-details">
                <%= option[:description] %>
              </div>
            </div>
          </div>
        <% end %>
        <% if params.dig(:q, :price_category_eq).present? %>
          <div class="filter-option" onclick="clearFilterValue('price_category_eq')">
            <span class="filter-option-label">„Åô„Åπ„Å¶Ë°®Á§∫</span>
          </div>
        <% end %>
      </div>
      <%= f.hidden_field :price_category_eq, value: params.dig(:q, :price_category_eq) %>
    </div>
    <!-- Âñ´ÁÖôÁä∂Ê≥Å„Éï„Ç£„É´„Çø„Éº -->
    <div class="mb-6">
      <div class="sidebar-section-title">Âñ´ÁÖôÁä∂Ê≥Å</div>
      <div class="filter-options-container">
        <% [
        { value: 'Á¶ÅÁÖô', emoji: 'üö≠', label: 'Á¶ÅÁÖô' },
        { value: 'ÂàÜÁÖô', emoji: 'üö´', label: 'ÂàÜÁÖô' },
        { value: 'Âñ´ÁÖôÂèØ', emoji: 'üö¨', label: 'Âñ´ÁÖôÂèØ' },
        { value: 'Â±ãÂ§ñÂñ´ÁÖôÂèØ', emoji: 'üå¨Ô∏è', label: 'Â±ãÂ§ñÂñ´ÁÖôÂèØ' }
      ].each do |option| %>
          <div class="filter-option <%= 'active' if params.dig(:q, :smoking_status_eq) == option[:value] %>"
             onclick="setFilterValue('smoking_status_eq', '<%= option[:value] %>')">
            <span class="text-lg"><%= option[:emoji] %></span>
            <span class="filter-option-label"><%= option[:label] %></span>
          </div>
        <% end %>
        <% if params.dig(:q, :smoking_status_eq).present? %>
          <div class="filter-option" onclick="clearFilterValue('smoking_status_eq')">
            <span class="filter-option-label">„Åô„Åπ„Å¶Ë°®Á§∫</span>
          </div>
        <% end %>
      </div>
      <%= f.hidden_field :smoking_status_eq, value: params.dig(:q, :smoking_status_eq) %>
    </div>
    <% if search_performed? %>
      <div class="mb-6">
        <div class="filter-option" onclick="clearAllFiltersUnified()" style="justify-content: center; background-color: var(--wine); color: white;">
          <span class="filter-option-label">„Åô„Åπ„Å¶„ÅÆÊù°‰ª∂„Çí„ÇØ„É™„Ç¢</span>
        </div>
      </div>
    <% end %>
  <% end %>
  <!-- „É¢„Éê„Ç§„É´Áî®„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóJavaScriptÁ∞°ÊòìÂÆüË£Ö‰∏≠ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (window.innerWidth <= 768) {
        document.querySelectorAll('[data-tooltip]').forEach(element => {
          element.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            // Êó¢Â≠ò„ÅÆtooltip„ÇíÂâäÈô§
            document.querySelectorAll('.tooltip-active').forEach(el => {
              el.classList.remove('tooltip-active');
            });

            // Êñ∞„Åó„ÅÑtooltip„ÇíË°®Á§∫
            this.classList.add('tooltip-active');

            // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÂâäÈô§
            setTimeout(() => {
              this.classList.remove('tooltip-active');
            }, 3000);
          });
        });

        // ËÉåÊôØ„Çø„ÉÉ„Éó„Åßtooltip„ÇíÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
          if (!e.target.closest('[data-tooltip]')) {
            document.querySelectorAll('.tooltip-active').forEach(el => {
              el.classList.remove('tooltip-active');
            });
          }
        });
      }
    });
  </script>
